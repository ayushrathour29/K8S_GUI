
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kubernetes Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #4285f4;
        }

        .nav {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(45deg, #4285f4, #34a853);
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .nav-btn.active {
            background: linear-gradient(45deg, #ea4335, #fbbc04);
        }

        .login-form {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 40px;
            max-width: 400px;
            margin: 100px auto;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus {
            outline: none;
            border-color: #4285f4;
        }

        .btn {
            background: linear-gradient(45deg, #4285f4, #34a853);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-danger {
            background: linear-gradient(45deg, #ea4335, #ff6b6b);
        }

        .btn-success {
            background: linear-gradient(45deg, #34a853, #4caf50);
        }

        .dashboard {
            display: none;
        }

        .dashboard.active {
            display: block;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .content-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: #333;
            border-bottom: 3px solid #4285f4;
            padding-bottom: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th,
        .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }

        .table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #555;
        }

        .table tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            text-transform: uppercase;
        }

        .status-running {
            background: #d4edda;
            color: #155724;
        }

        .status-ready {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-failed {
            background: #f8d7da;
            color: #721c24;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 12px;
            margin: 2px;
            transition: all 0.3s ease;
        }

        .create-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4285f4, #34a853);
            transition: width 0.3s ease;
        }

        .log-viewer {
            background: #1e1e1e;
            color: #00ff00;
            font-family: 'Courier New', monospace;
            padding: 20px;
            border-radius: 10px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 12px;
            line-height: 1.4;
        }

        .hidden {
            display: none;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4285f4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #f5c6cb;
        }

        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            border: 1px solid #c3e6cb;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .nav {
                flex-wrap: wrap;
                justify-content: center;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }

            .create-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Form -->
    <div id="loginForm" class="login-form">
        <h2 style="text-align: center; margin-bottom: 30px; color: #333;">Kubernetes Dashboard</h2>
        <div class="form-group">
            <label for="username">Username</label>
            <input type="text" id="username" value="admin" required>
        </div>
        <div class="form-group">
            <label for="password">Password</label>
            <input type="password" id="password" value="password" required>
        </div>
        <button class="btn" onclick="login()">Login</button>
        <div id="loginError" class="error hidden"></div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" class="container hidden">
        <div class="header">
            <div class="logo">ðŸš¢ K8s Dashboard</div>
            <nav class="nav">
                <button class="nav-btn active" onclick="showSection('overview')">Overview</button>
                <button class="nav-btn" onclick="showSection('pods')">Pods</button>
                <button class="nav-btn" onclick="showSection('deployments')">Deployments</button>
                <button class="nav-btn" onclick="showSection('services')">Services</button>
                <button class="nav-btn" onclick="showSection('namespaces')">Namespaces</button>
                <button class="nav-btn" onclick="showSection('nodes')">Nodes</button>
                <button class="nav-btn" onclick="showSection('events')">Events</button>
                <button class="nav-btn" onclick="showSection('metrics')">Metrics</button>
                <button class="nav-btn" onclick="logout()">Logout</button>
            </nav>
        </div>

        <!-- Overview Section -->
        <div id="overview" class="dashboard active">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="clusterStatus">ðŸŸ¢</div>
                    <div class="stat-label">Cluster Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="nodeCount">-</div>
                    <div class="stat-label">Nodes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="podCount">-</div>
                    <div class="stat-label">Pods</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="deploymentCount">-</div>
                    <div class="stat-label">Deployments</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="serviceCount">-</div>
                    <div class="stat-label">Services</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="namespaceCount">-</div>
                    <div class="stat-label">Namespaces</div>
                </div>
            </div>

            <div class="content-section">
                <h2 class="section-title">Cluster Information</h2>
                <div id="clusterInfo">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading cluster information...
                    </div>
                </div>
            </div>
        </div>

        <!-- Pods Section -->
        <div id="pods" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Pods Management</h2>
                
                <div class="create-form">
                    <h3 style="grid-column: 1 / -1; margin-bottom: 15px;">Quick Actions</h3>
                    <button class="btn" onclick="refreshPods()">ðŸ”„ Refresh</button>
                    <button class="btn" onclick="showPodLogs()">ðŸ“„ View Logs</button>
                </div>

                <div id="podsTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading pods...
                    </div>
                </div>
            </div>
        </div>

        <!-- Deployments Section -->
        <div id="deployments" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Deployments Management</h2>
                
                <div class="create-form">
                    <h3 style="grid-column: 1 / -1; margin-bottom: 15px;">Create New Deployment</h3>
                    <input type="text" id="deploymentName" placeholder="Deployment Name" required>
                    <input type="text" id="deploymentNamespace" placeholder="Namespace" value="default" required>
                    <input type="text" id="deploymentImage" placeholder="Container Image" required>
                    <input type="number" id="deploymentReplicas" placeholder="Replicas" value="1" min="1" required>
                    <input type="number" id="deploymentPort" placeholder="Container Port" value="80" required>
                    <button class="btn btn-success" onclick="createDeployment()">Create Deployment</button>
                    <button class="btn" onclick="refreshDeployments()">ðŸ”„ Refresh</button>
                </div>

                <div id="deploymentsTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading deployments...
                    </div>
                </div>
            </div>
        </div>

        <!-- Services Section -->
        <div id="services" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Services Management</h2>
                
                <div class="create-form">
                    <h3 style="grid-column: 1 / -1; margin-bottom: 15px;">Create New Service</h3>
                    <input type="text" id="serviceName" placeholder="Service Name" required>
                    <input type="text" id="serviceNamespace" placeholder="Namespace" value="default" required>
                    <input type="number" id="servicePort" placeholder="Service Port" value="80" required>
                    <input type="number" id="serviceTargetPort" placeholder="Target Port" value="80" required>
                    <button class="btn btn-success" onclick="createService()">Create Service</button>
                    <button class="btn" onclick="refreshServices()">ðŸ”„ Refresh</button>
                </div>

                <div id="servicesTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading services...
                    </div>
                </div>
            </div>
        </div>

        <!-- Namespaces Section -->
        <div id="namespaces" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Namespaces Management</h2>
                
                <div class="create-form">
                    <h3 style="grid-column: 1 / -1; margin-bottom: 15px;">Create New Namespace</h3>
                    <input type="text" id="namespaceName" placeholder="Namespace Name" required>
                    <button class="btn btn-success" onclick="createNamespace()">Create Namespace</button>
                    <button class="btn" onclick="refreshNamespaces()">ðŸ”„ Refresh</button>
                </div>

                <div id="namespacesTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading namespaces...
                    </div>
                </div>
            </div>
        </div>

        <!-- Nodes Section -->
        <div id="nodes" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Nodes Information</h2>
                
                <div class="create-form">
                    <button class="btn" onclick="refreshNodes()">ðŸ”„ Refresh</button>
                </div>

                <div id="nodesTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading nodes...
                    </div>
                </div>
            </div>
        </div>

        <!-- Events Section -->
        <div id="events" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Cluster Events</h2>
                
                <div class="create-form">
                    <button class="btn" onclick="refreshEvents()">ðŸ”„ Refresh All Events</button>
                    <select id="eventNamespace" onchange="filterEventsByNamespace()">
                        <option value="">All Namespaces</option>
                    </select>
                </div>

                <div id="eventsTable">
                    <div class="loading">
                        <div class="spinner"></div>
                        Loading events...
                    </div>
                </div>
            </div>
        </div>

        <!-- Metrics Section -->
        <div id="metrics" class="dashboard">
            <div class="content-section">
                <h2 class="section-title">Cluster Metrics</h2>
                
                <div class="create-form">
                    <button class="btn" onclick="refreshMetrics()">ðŸ”„ Refresh Metrics</button>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <h3>Node Metrics</h3>
                        <div id="nodeMetrics">
                            <div class="loading">Loading node metrics...</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <h3>Pod Metrics</h3>
                        <div id="podMetrics">
                            <div class="loading">Loading pod metrics...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pod Logs Modal -->
    <div id="logModal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
        <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80%; max-width: 800px; background: white; border-radius: 15px; padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h3>Pod Logs</h3>
                <button onclick="closeLogs()" style="background: none; border: none; font-size: 24px; cursor: pointer;">âœ•</button>
            </div>
            <div>
                <select id="logPodSelect" style="margin-bottom: 10px; padding: 8px; border-radius: 5px; border: 1px solid #ccc;">
                    <option value="">Select a pod...</option>
                </select>
                <button onclick="fetchPodLogs()" style="margin-left: 10px; padding: 8px 15px; border: none; background: #4285f4; color: white; border-radius: 5px; cursor: pointer;">Get Logs</button>
            </div>
            <div id="logContent" class="log-viewer" style="margin-top: 20px;">
                Select a pod to view logs...
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let authToken = '';
        const API_BASE = 'http://localhost:8081/api';

        // Authentication
        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            try {
                const response = await fetch(`${API_BASE}/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ username, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    authToken = data.token;
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('mainDashboard').classList.remove('hidden');
                    loadOverview();
                } else {
                    showError('loginError', 'Invalid credentials');
                }
            } catch (error) {
                showError('loginError', 'Connection error: ' + error.message);
            }
        }

        function logout() {
            authToken = '';
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('mainDashboard').classList.add('hidden');
            showSection('overview');
        }

        // Utility functions
        function showError(elementId, message) {
            const errorElement = document.getElementById(elementId);
            errorElement.textContent = message;
            errorElement.classList.remove('hidden');
            setTimeout(() => errorElement.classList.add('hidden'), 5000);
        }

        function showSuccess(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success';
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            setTimeout(() => successDiv.remove(), 3000);
        }

        async function apiCall(endpoint, options = {}) {
            const config = {
                headers: {
                    'Authorization': `Bearer ${authToken}`,
                    'Content-Type': 'application/json',
                },
                ...options
            };

            const response = await fetch(`${API_BASE}${endpoint}`, config);
            
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            
            return response.json();
        }

        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.dashboard').forEach(section => {
                section.classList.remove('active');
            });
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected section
            document.getElementById(sectionName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
            
            // Load section data
            switch(sectionName) {
                case 'overview':
                    loadOverview();
                    break;
                case 'pods':
                    loadPods();
                    break;
                case 'deployments':
                    loadDeployments();
                    break;
                case 'services':
                    loadServices();
                    break;
                case 'namespaces':
                    loadNamespaces();
                    break;
                case 'nodes':
                    loadNodes();
                    break;
                case 'events':
                    loadEvents();
                    break;
                case 'metrics':
                    loadMetrics();
                    break;
            }
        }

        // Overview functions
        async function loadOverview() {
            try {
                // Load cluster info
                const clusterData = await apiCall('/clusters');
                document.getElementById('clusterStatus').textContent = clusterData.healthy ? 'ðŸŸ¢' : 'ðŸ”´';
                document.getElementById('nodeCount').textContent = clusterData.nodes;
                
                document.getElementById('clusterInfo').innerHTML = `
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px;">
                        <div><strong>Cluster Name:</strong> ${clusterData.name}</div>
                        <div><strong>Version:</strong> ${clusterData.version}</div>
                        <div><strong>Status:</strong> <span class="status-badge status-${clusterData.healthy ? 'ready' : 'failed'}">${clusterData.status}</span></div>
                        <div><strong>Nodes:</strong> ${clusterData.nodes}</div>
                    </div>
                `;

                // Load counts
                const [pods, deployments, services, namespaces] = await Promise.all([
                    apiCall('/pods'),
                    apiCall('/deployments'),
                    apiCall('/services'),
                    apiCall('/namespaces')
                ]);

                document.getElementById('podCount').textContent = pods.items.length;
                document.getElementById('deploymentCount').textContent = deployments.items.length;
                document.getElementById('serviceCount').textContent = services.items.length;
                document.getElementById('namespaceCount').textContent = namespaces.items.length;

            } catch (error) {
                console.error('Error loading overview:', error);
                document.getElementById('clusterInfo').innerHTML = `<div class="error">Error loading cluster information: ${error.message}</div>`;
            }
        }

        // Pods functions
        async function loadPods() {
            try {
                const data = await apiCall('/pods');
                renderPodsTable(data.items);
                populatePodSelector(data.items);
            } catch (error) {
                document.getElementById('podsTable').innerHTML = `<div class="error">Error loading pods: ${error.message}</div>`;
            }
        }

        function renderPodsTable(pods) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Namespace</th>
                            <th>Status</th>
                            <th>Restarts</th>
                            <th>Node</th>
                            <th>IP</th>
                            <th>Age</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${pods.map(pod => `
                            <tr>
                                <td>${pod.name}</td>
                                <td>${pod.namespace}</td>
                                <td><span class="status-badge status-${pod.status.toLowerCase()}">${pod.status}</span></td>
                                <td>${pod.restartCount}</td>
                                <td>${pod.nodeName || 'N/A'}</td>
                                <td>${pod.podIP || 'N/A'}</td>
                                <td>${formatAge(pod.createdAt)}</td>
                                <td>
                                    <button class="action-btn btn-danger" onclick="deletePod('${pod.namespace}', '${pod.name}')">Delete</button>
                                    <button class="action-btn" onclick="showPodDetails('${pod.namespace}', '${pod.name}')">Details</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('podsTable').innerHTML = table;
        }

        async function deletePod(namespace, name) {
            if (confirm(`Are you sure you want to delete pod ${name}?`)) {
                try {
                    await apiCall(`/pods/${namespace}/${name}`, { method: 'DELETE' });
                    showSuccess('Pod deleted successfully');
                    loadPods();
                } catch (error) {
                    alert('Error deleting pod: ' + error.message);
                }
            }
        }

        function refreshPods() {
            loadPods();
        }

        // Deployments functions
        async function loadDeployments() {
            try {
                const data = await apiCall('/deployments');
                renderDeploymentsTable(data.items);
            } catch (error) {
                document.getElementById('deploymentsTable').innerHTML = `<div class="error">Error loading deployments: ${error.message}</div>`;
            }
        }

        function renderDeploymentsTable(deployments) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Namespace</th>
                            <th>Replicas</th>
                            <th>Available</th>
                            <th>Strategy</th>
                            <th>Age</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${deployments.map(deployment => `
                            <tr>
                                <td>${deployment.name}</td>
                                <td>${deployment.namespace}</td>
                                <td>${deployment.replicas}</td>
                                <td>${deployment.availableReplicas}</td>
                                <td>${deployment.strategy}</td>
                                <td>${formatAge(deployment.createdAt)}</td>
                                <td>
                                    <button class="action-btn btn-danger" onclick="deleteDeployment('${deployment.namespace}', '${deployment.name}')">Delete</button>
                                    <button class="action-btn" onclick="updateDeployment('${deployment.namespace}', '${deployment.name}')">Update</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('deploymentsTable').innerHTML = table;
        }

        async function createDeployment() {
            const name = document.getElementById('deploymentName').value;
            const namespace = document.getElementById('deploymentNamespace').value;
            const image = document.getElementById('deploymentImage').value;
            const replicas = parseInt(document.getElementById('deploymentReplicas').value);
            const port = parseInt(document.getElementById('deploymentPort').value);

            if (!name || !namespace || !image || !replicas || !port) {
                alert('Please fill all fields');
                return;
            }

            try {
                await apiCall('/deployments', {
                    method: 'POST',
                    body: JSON.stringify({ name, namespace, image, replicas, port })
                });
                showSuccess('Deployment created successfully');
                loadDeployments();
                // Clear form
                document.getElementById('deploymentName').value = '';
                document.getElementById('deploymentImage').value = '';
                document.getElementById('deploymentReplicas').value = '1';
                document.getElementById('deploymentPort').value = '80';
            } catch (error) {
                alert('Error creating deployment: ' + error.message);
            }
        }

        async function deleteDeployment(namespace, name) {
            if (confirm(`Are you sure you want to delete deployment ${name}?`)) {
                try {
                    await apiCall(`/deployments/${namespace}/${name}`, { method: 'DELETE' });
                    showSuccess('Deployment deleted successfully');
                    loadDeployments();
                } catch (error) {
                    alert('Error deleting deployment: ' + error.message);
                }
            }
        }

        function refreshDeployments() {
            loadDeployments();
        }

        // Services functions
        async function loadServices() {
            try {
                const data = await apiCall('/services');
                renderServicesTable(data.items);
            } catch (error) {
                document.getElementById('servicesTable').innerHTML = `<div class="error">Error loading services: ${error.message}</div>`;
            }
        }

        function renderServicesTable(services) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Namespace</th>
                            <th>Type</th>
                            <th>Cluster IP</th>
                            <th>Ports</th>
                            <th>Age</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${services.map(service => `
                            <tr>
                                <td>${service.name}</td>
                                <td>${service.namespace}</td>
                                <td>${service.type}</td>
                                <td>${service.clusterIP}</td>
                                <td>${service.ports.map(p => `${p.port}/${p.protocol}`).join(', ')}</td>
                                <td>${formatAge(service.createdAt)}</td>
                                <td>
                                    <button class="action-btn btn-danger" onclick="deleteService('${service.namespace}', '${service.name}')">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('servicesTable').innerHTML = table;
        }

        async function createService() {
            const name = document.getElementById('serviceName').value;
            const namespace = document.getElementById('serviceNamespace').value;
            const port = parseInt(document.getElementById('servicePort').value);
            const targetPort = parseInt(document.getElementById('serviceTargetPort').value);

            if (!name || !namespace || !port || !targetPort) {
                alert('Please fill all fields');
                return;
            }

            try {
                await apiCall('/services', {
                    method: 'POST',
                    body: JSON.stringify({ name, namespace, port, targetPort })
                });
                showSuccess('Service created successfully');
                loadServices();
                // Clear form
                document.getElementById('serviceName').value = '';
                document.getElementById('servicePort').value = '80';
                document.getElementById('serviceTargetPort').value = '80';
            } catch (error) {
                alert('Error creating service: ' + error.message);
            }
        }

        async function deleteService(namespace, name) {
            if (confirm(`Are you sure you want to delete service ${name}?`)) {
                try {
                    await apiCall(`/services/${namespace}/${name}`, { method: 'DELETE' });
                    showSuccess('Service deleted successfully');
                    loadServices();
                } catch (error) {
                    alert('Error deleting service: ' + error.message);
                }
            }
        }

        function refreshServices() {
            loadServices();
        }

        // Namespaces functions
        async function loadNamespaces() {
            try {
                const data = await apiCall('/namespaces');
                renderNamespacesTable(data.items);
                populateNamespaceSelector(data.items);
            } catch (error) {
                document.getElementById('namespacesTable').innerHTML = `<div class="error">Error loading namespaces: ${error.message}</div>`;
            }
        }

        function renderNamespacesTable(namespaces) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Age</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${namespaces.map(namespace => `
                            <tr>
                                <td>${namespace.name}</td>
                                <td><span class="status-badge status-${namespace.status.toLowerCase()}">${namespace.status}</span></td>
                                <td>${formatAge(namespace.createdAt)}</td>
                                <td>
                                    ${namespace.name !== 'default' && namespace.name !== 'kube-system' ? 
                                        `<button class="action-btn btn-danger" onclick="deleteNamespace('${namespace.name}')">Delete</button>` : 
                                        '<span style="color: #999;">Protected</span>'
                                    }
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('namespacesTable').innerHTML = table;
        }

        async function createNamespace() {
            const name = document.getElementById('namespaceName').value;

            if (!name) {
                alert('Please enter namespace name');
                return;
            }

            try {
                await apiCall('/namespaces', {
                    method: 'POST',
                    body: JSON.stringify({ name })
                });
                showSuccess('Namespace created successfully');
                loadNamespaces();
                document.getElementById('namespaceName').value = '';
            } catch (error) {
                alert('Error creating namespace: ' + error.message);
            }
        }

        async function deleteNamespace(name) {
            if (confirm(`Are you sure you want to delete namespace ${name}? This will delete all resources in the namespace.`)) {
                try {
                    await apiCall(`/namespaces/${name}`, { method: 'DELETE' });
                    showSuccess('Namespace deleted successfully');
                    loadNamespaces();
                } catch (error) {
                    alert('Error deleting namespace: ' + error.message);
                }
            }
        }

        function refreshNamespaces() {
            loadNamespaces();
        }

        // Nodes functions
        async function loadNodes() {
            try {
                const data = await apiCall('/nodes');
                renderNodesTable(data.items);
            } catch (error) {
                document.getElementById('nodesTable').innerHTML = `<div class="error">Error loading nodes: ${error.message}</div>`;
            }
        }

        function renderNodesTable(nodes) {
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Status</th>
                            <th>Version</th>
                            <th>OS</th>
                            <th>CPU</th>
                            <th>Memory</th>
                            <th>Age</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${nodes.map(node => `
                            <tr>
                                <td>${node.name}</td>
                                <td><span class="status-badge status-${node.status.toLowerCase()}">${node.status}</span></td>
                                <td>${node.version}</td>
                                <td>${node.osImage}</td>
                                <td>${node.capacity.cpu || 'N/A'}</td>
                                <td>${formatBytes(node.capacity.memory)}</td>
                                <td>${formatAge(node.createdAt)}</td>
                                <td>
                                    <button class="action-btn" onclick="getNodeMetrics('${node.name}')">Metrics</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('nodesTable').innerHTML = table;
        }

        function refreshNodes() {
            loadNodes();
        }

        // Events functions
        async function loadEvents() {
            try {
                const data = await apiCall('/events');
                renderEventsTable(data.items);
            } catch (error) {
                document.getElementById('eventsTable').innerHTML = `<div class="error">Error loading events: ${error.message}</div>`;
            }
        }

        function renderEventsTable(events) {
            // Sort events by timestamp (most recent first)
            events.sort((a, b) => new Date(b.lastTimestamp) - new Date(a.lastTimestamp));
            
            const table = `
                <table class="table">
                    <thead>
                        <tr>
                            <th>Type</th>
                            <th>Reason</th>
                            <th>Object</th>
                            <th>Message</th>
                            <th>Count</th>
                            <th>Last Seen</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${events.slice(0, 100).map(event => `
                            <tr>
                                <td><span class="status-badge ${event.type === 'Warning' ? 'status-failed' : 'status-ready'}">${event.type}</span></td>
                                <td>${event.reason}</td>
                                <td>${event.involvedObject}</td>
                                <td>${event.message}</td>
                                <td>${event.count}</td>
                                <td>${formatAge(event.lastTimestamp)}</td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('eventsTable').innerHTML = table;
        }

        function refreshEvents() {
            loadEvents();
        }

        // Metrics functions
        async function loadMetrics() {
            try {
                const [nodeMetrics, podMetrics] = await Promise.all([
                    apiCall('/metrics/nodes').catch(() => ({ items: [] })),
                    apiCall('/metrics/pods').catch(() => ({ items: [] }))
                ]);

                renderNodeMetrics(nodeMetrics.items);
                renderPodMetrics(podMetrics.items);
            } catch (error) {
                document.getElementById('nodeMetrics').innerHTML = `<div class="error">Error loading metrics: ${error.message}</div>`;
                document.getElementById('podMetrics').innerHTML = `<div class="error">Error loading metrics: ${error.message}</div>`;
            }
        }

        function renderNodeMetrics(metrics) {
            if (metrics.length === 0) {
                document.getElementById('nodeMetrics').innerHTML = '<div class="error">Metrics server not available</div>';
                return;
            }

            const content = metrics.map(metric => `
                <div style="margin-bottom: 20px; padding: 15px; border: 1px solid #eee; border-radius: 8px;">
                    <h4>${metric.nodeName}</h4>
                    <div style="margin: 10px 0;">
                        <strong>CPU:</strong> ${metric.cpu.value} (${metric.cpu.percentage ? metric.cpu.percentage.toFixed(1) + '%' : 'N/A'})
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${metric.cpu.percentage || 0}%"></div>
                        </div>
                    </div>
                    <div style="margin: 10px 0;">
                        <strong>Memory:</strong> ${formatBytes(metric.memory.quantity)} (${metric.memory.percentage ? metric.memory.percentage.toFixed(1) + '%' : 'N/A'})
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${metric.memory.percentage || 0}%"></div>
                        </div>
                    </div>
                </div>
            `).join('');

            document.getElementById('nodeMetrics').innerHTML = content;
        }

        function renderPodMetrics(metrics) {
            if (metrics.length === 0) {
                document.getElementById('podMetrics').innerHTML = '<div class="error">No pod metrics available</div>';
                return;
            }

            const content = `
                <div style="max-height: 400px; overflow-y: auto;">
                    ${metrics.slice(0, 20).map(metric => `
                        <div style="margin-bottom: 15px; padding: 10px; border: 1px solid #eee; border-radius: 8px;">
                            <h5>${metric.podName} (${metric.namespace})</h5>
                            <div><strong>CPU:</strong> ${metric.cpu.value}</div>
                            <div><strong>Memory:</strong> ${formatBytes(metric.memory.quantity)}</div>
                        </div>
                    `).join('')}
                </div>
            `;

            document.getElementById('podMetrics').innerHTML = content;
        }

        function refreshMetrics() {
            loadMetrics();
        }

        // Logs functions
        function showPodLogs() {
            document.getElementById('logModal').classList.remove('hidden');
        }

        function closeLogs() {
            document.getElementById('logModal').classList.add('hidden');
        }

        function populatePodSelector(pods) {
            const select = document.getElementById('logPodSelect');
            select.innerHTML = '<option value="">Select a pod...</option>';
            
            pods.forEach(pod => {
                const option = document.createElement('option');
                option.value = `${pod.namespace}/${pod.name}`;
                option.textContent = `${pod.name} (${pod.namespace})`;
                select.appendChild(option);
            });
        }

        async function fetchPodLogs() {
            const selectedPod = document.getElementById('logPodSelect').value;
            if (!selectedPod) {
                alert('Please select a pod');
                return;
            }

            const [namespace, name] = selectedPod.split('/');
            
            try {
                const response = await fetch(`${API_BASE}/pods/${namespace}/${name}/logs`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                    }
                });

                if (response.ok) {
                    const logs = await response.text();
                    document.getElementById('logContent').textContent = logs || 'No logs available';
                } else {
                    document.getElementById('logContent').textContent = 'Error fetching logs';
                }
            } catch (error) {
                document.getElementById('logContent').textContent = 'Error: ' + error.message;
            }
        }

        // Utility functions
        function populateNamespaceSelector(namespaces) {
            const select = document.getElementById('eventNamespace');
            select.innerHTML = '<option value="">All Namespaces</option>';
            
            namespaces.forEach(namespace => {
                const option = document.createElement('option');
                option.value = namespace.name;
                option.textContent = namespace.name;
                select.appendChild(option);
            });
        }

        async function filterEventsByNamespace() {
            const namespace = document.getElementById('eventNamespace').value;
            
            try {
                const data = namespace ? 
                    await apiCall(`/events/${namespace}`) : 
                    await apiCall('/events');
                renderEventsTable(data.items);
            } catch (error) {
                document.getElementById('eventsTable').innerHTML = `<div class="error">Error loading events: ${error.message}</div>`;
            }
        }

        async function getNodeMetrics(nodeName) {
            try {
                const data = await apiCall(`/nodes/${nodeName}/metrics`);
                alert(`Node Metrics for ${nodeName}:\nCPU: ${data.cpu.value}\nMemory: ${data.memory.value}\nAvailable: ${data.available ? 'Yes' : 'No'}`);
            } catch (error) {
                alert('Error getting node metrics: ' + error.message);
            }
        }

        function formatAge(dateString) {
            const now = new Date();
            const date = new Date(dateString);
            const diffInSeconds = Math.floor((now - date) / 1000);
            
            if (diffInSeconds < 60) return `${diffInSeconds}s`;
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h`;
            return `${Math.floor(diffInSeconds / 86400)}d`;
        }

        function formatBytes(bytes) {
            if (!bytes || bytes === 'N/A') return 'N/A';
            
            // Handle string input like "1000Ki"
            if (typeof bytes === 'string') {
                if (bytes.endsWith('Ki')) {
                    bytes = parseInt(bytes) * 1024;
                } else if (bytes.endsWith('Mi')) {
                    bytes = parseInt(bytes) * 1024 * 1024;
                } else if (bytes.endsWith('Gi')) {
                    bytes = parseInt(bytes) * 1024 * 1024 * 1024;
                } else {
                    bytes = parseInt(bytes);
                }
            }
            
            const sizes = ['B', 'KB', 'MB', 'GB', 'TB'];
            if (bytes === 0) return '0 B';
            const i = Math.floor(Math.log(bytes) / Math.log(1024));
            return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
        }

        // Auto-refresh functionality
        setInterval(() => {
            const activeSection = document.querySelector('.dashboard.active');
            if (activeSection && authToken) {
                const sectionId = activeSection.id;
                if (sectionId === 'overview') {
                    loadOverview();
                }
            }
        }, 30000); // Refresh every 30 seconds

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Kubernetes Dashboard loaded');
        });
    </script>
</body>
</html>